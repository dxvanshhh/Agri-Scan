<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Agri-Scan: Field Health Scan</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div id="vanta-bg"></div>

    <nav>
        <a href="home.html" class="logo">ðŸŒ¿ Agri-Scan</a>
        <div class="nav-links">
            <a href="home.html" data-key="nav_home">Home</a>
            <a href="scan.html" data-key="nav_scan">Leaf Scan</a>
            <a href="field_scan.html" data-key="nav_field_scan">Field Scan</a>
            <a href="about.html" data-key="nav_about">About</a>
            <a href="project.html" data-key="nav_project">Project Details</a>
            <div class="lang-toggle">
                <button id="lang-en" class="active">EN</button>
                <button id="lang-hi">HI</button>
            </div>
            <div class="notification-bell">
                <span class="bell-icon" id="bell-icon">ðŸ””</span>
                <span class="dot" id="bell-dot"></span>
                <div class="notification-dropdown" id="notification-menu">
                    <div class="header" data-key="alert_title">Proactive Alerts</div>
                    <div class="alert-item"><strong data-key="alert_1_title">FUNGAL ALERT</strong><div data-key="alert_1_body">High humidity in your area increases risk for Late Blight.</div><div class="time">1 hour ago</div></div>
                    <div class="alert-item"><strong data-key="alert_2_title">VIRUS ALERT</strong><div data-key="alert_2_body">Whitefly populations detected nearby. Monitor tomatoes for Yellow Leaf Curl Virus.</div><div class="time">1 day ago</div></div>
                </div>
            </div>
            <a href="index.html" data-key="nav_logout" style="opacity: 1; color: #ffadad;">Logout</a>
        </div>
    </nav>

    <div class="container">
        <div class="card">
            <h1 data-key="field_scan_title">Field Health Analysis (Model B)</h1>
            <p data-key="field_scan_subtitle" style="opacity: 0.8;">Upload a wide-angle photo of your crop rows to detect nutrient deficiencies.</p>
            
            <input type="file" id="imageUpload" accept="image/*" />
            
            <img id="image-preview" />
            <img id="image-result-heatmap" style="display: none; width: 100%; border-radius: 8px; margin-top: 1.5rem;" />
            
            <div class="spinner" id="loading-spinner"></div>
            
            <div id="results-container" style="display: none; text-align: left;">
                </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r134/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/vanta@latest/dist/vanta.net.min.js"></script>
    <script src="lang.js"></script> <script>
        // Start 3D Background
        VANTA.NET({ el: "#vanta-bg", /* ... 3D settings ... */ mouseControls: true, touchControls: true, minHeight: 200.00, minWidth: 200.00, scale: 1.00, scaleMobile: 1.00, color: 0x3bff84, backgroundColor: 0x1a2a1a, points: 10.00, maxDistance: 25.00, spacing: 18.00 });

        // --- "FLAW-PROOF" SEGMENTATION DEMO ---
        
        // This is a REAL image of a nutrient heatmap. This is what your "Model B" would output.
        const HEATMAP_RESULT_URL = "https://ag-smart.net/wp-content/uploads/2021/04/Variable-Rate-Nitrogen.jpg";

        const imageUpload = document.getElementById("imageUpload");
        const imagePreview = document.getElementById("image-preview");
        const imageResultHeatmap = document.getElementById("image-result-heatmap");
        const resultsDiv = document.getElementById("results-container");
        const spinner = document.getElementById("loading-spinner");

        imageUpload.addEventListener("change", (event) => {
            const file = event.target.files[0];
            if (!file) return;

            // 1. Show the user's uploaded image
            const reader = new FileReader();
            reader.onload = (e) => {
                imagePreview.src = e.target.result;
                imagePreview.style.display = "block";
            };
            reader.readAsDataURL(file);

            // 2. Hide old results and show spinner
            resultsDiv.style.display = "none";
            imageResultHeatmap.style.display = "none";
            spinner.style.display = "block";

            // 3. SIMULATE AI processing (3 seconds)
            setTimeout(() => {
                // 4. Hide spinner and user image
                spinner.style.display = "none";
                imagePreview.style.display = "none";

                // 5. Show the "Processed" Heatmap Image
                imageResultHeatmap.src = HEATMAP_RESULT_URL;
                imageResultHeatmap.style.display = "block";
                
                // 6. Show the "Diagnosis"
                renderFieldResults();
                resultsDiv.style.display = "block";

            }, 3000); // 3-second fake delay
        });

        function renderFieldResults() {
            const lang = getCurrentLanguage();
            
            // Get translations
            const diagnosisText = translations[lang]["diag_nitrogen"];
            const insightsTitle = translations[lang]["scan_insights_title"];
            const insight1 = translations[lang]["insight_nitrogen_1"];
            const insight2 = translations[lang]["insight_nitrogen_2"];

            resultsDiv.innerHTML = `
                <h2 style="color: #f0ad4e;" data-key="diag_nitrogen">${diagnosisText}</h2>
                <hr>
                <h3 data-key="scan_insights_title">${insightsTitle}</h3>
                <ul>
                    <li data-key="insight_nitrogen_1">${insight1}</li>
                    <li data-key="insight_nitrogen_2">${insight2}</li>
                </ul>
            `;
        }
    </script>
</body>
</html>